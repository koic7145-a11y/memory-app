<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icon.svg">
  <title>暗記マスター - エビングハウスの忘却曲線で効率的に記憶</title>
  <meta name="description" content="エビングハウスの忘却曲線に基づく暗記カードアプリ。効率的に記憶を定着させます。">
  <meta name="robots" content="noindex, nofollow">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>

  <div class="container">

    <!-- ===== Header ===== -->
    <header class="header">
      <h1 class="header-title">
        <svg viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2" />
          <path d="M12 6v6l4 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        暗記マスター
      </h1>
      <p class="header-subtitle">エビングハウスの忘却曲線で効率的に記憶</p>
      <div class="header-actions">
        <span class="sync-indicator" id="syncIndicator" title="同期状態">
          <span class="sync-dot offline"></span>
          <span class="sync-text" id="syncText">未接続</span>
        </span>
        <button class="btn-icon" id="settingsBtn" aria-label="設定">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
            </path>
          </svg>
        </button>
      </div>
    </header>

    <!-- ===== Stats Dashboard ===== -->
    <section class="section">
      <div class="stats-grid">
        <div class="stat-card">
          <svg class="stat-icon" viewBox="0 0 24 24">
            <rect x="3" y="3" width="7" height="7" rx="1" />
            <rect x="14" y="3" width="7" height="7" rx="1" />
            <rect x="3" y="14" width="7" height="7" rx="1" />
            <rect x="14" y="14" width="7" height="7" rx="1" />
          </svg>
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-label">総カード数</div>
        </div>
        <div class="stat-card">
          <svg class="stat-icon" viewBox="0 0 24 24">
            <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" />
          </svg>
          <div class="stat-value" id="statToday">0</div>
          <div class="stat-label">今日の復習</div>
        </div>
        <div class="stat-card">
          <svg class="stat-icon" viewBox="0 0 24 24">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <div class="stat-value" id="statMastered">0</div>
          <div class="stat-label">習得済み</div>
        </div>
        <div class="stat-card">
          <svg class="stat-icon" viewBox="0 0 24 24">
            <path d="M13 10V3L4 14h7v7l9-11h-7z" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <div class="stat-value" id="statStreak">0</div>
          <div class="stat-label">連続日数</div>
        </div>
      </div>
    </section>

    <!-- ===== Category Accuracy ===== -->
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M16 8v8H8V8h8m2-2H6v12h12V6z" fill="currentColor" />
          <path d="M3 3h18v2H3zm0 16h18v2H3z" fill="currentColor" />
        </svg>
        分野別正答率
      </h2>
      <div id="accuracyList" class="accuracy-list">
        <div class="empty-state">学習データがありません</div>
      </div>
    </section>

    <!-- ===== Card Form ===== -->
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M12 4v16m-8-8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        カードを追加
      </h2>
      <div class="card-form" id="cardForm">
        <div class="form-row">
          <!-- Question Image Upload -->
          <div class="form-group">
            <label class="form-label">問題画像</label>
            <div class="upload-zone" id="questionUploadZone" tabindex="0">
              <svg viewBox="0 0 24 24">
                <path
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div class="upload-zone-text">クリック / ドロップ / Ctrl+V</div>
              <div class="upload-zone-hint">画像をアップロード</div>
              <input type="file" id="questionFileInput" accept="image/*">
            </div>
          </div>
          <!-- Answer Image Upload -->
          <div class="form-group">
            <label class="form-label">解答画像</label>
            <div class="upload-zone" id="answerUploadZone" tabindex="0">
              <svg viewBox="0 0 24 24">
                <path
                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                  fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div class="upload-zone-text">クリック / ドロップ / Ctrl+V</div>
              <div class="upload-zone-hint">画像をアップロード</div>
              <input type="file" id="answerFileInput" accept="image/*">
            </div>
          </div>
        </div>

        <!-- Deck Selection (Hidden until images are uploaded) -->
        <div id="deckSelectionSection" class="hidden">
          <div class="form-group">
            <label class="form-label">デッキ</label>
            <div class="deck-select-row">
              <select class="form-select" id="categorySelect">
                <option value="">デッキを選択してください</option>
              </select>
              <button class="btn btn-icon" id="newDeckBtn" type="button" title="新しいデッキ">
                <svg viewBox="0 0 24 24" width="18" height="18">
                  <path d="M12 4v16m-8-8h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                </svg>
              </button>
            </div>
            <div class="new-deck-input hidden" id="newDeckInput">
              <select class="form-select" id="presetDeckSelect">
                <option value="">-- 分野から選択 --</option>
                <optgroup label="テクノロジ系">
                  <option value="基礎理論">基礎理論</option>
                  <option value="コンピュータシステム">コンピュータシステム</option>
                  <option value="データベース">データベース</option>
                  <option value="ネットワーク">ネットワーク</option>
                  <option value="セキュリティ">セキュリティ</option>
                  <option value="システム開発">システム開発</option>
                </optgroup>
                <optgroup label="マネジメント系">
                  <option value="プロジェクトマネジメント">プロジェクトマネジメント</option>
                  <option value="サービスマネジメント">サービスマネジメント</option>
                </optgroup>
                <optgroup label="ストラテジ系">
                  <option value="システム戦略">システム戦略</option>
                  <option value="経営戦略">経営戦略</option>
                  <option value="企業と法務">企業と法務</option>
                </optgroup>
              </select>
              <span class="deck-or-label">または</span>
              <input type="text" class="form-select" id="newDeckName" placeholder="カスタム名を入力">
              <button class="btn btn-sm btn-primary" id="createDeckBtn" type="button">作成</button>
              <button class="btn btn-sm btn-secondary" id="cancelNewDeckBtn" type="button">キャンセル</button>
            </div>
          </div>
        </div>

        <!-- Toggle & Actions -->
        <div class="toggle-row">
          <span class="toggle-label">連続登録モード</span>
          <label class="toggle-switch">
            <input type="checkbox" id="continuousMode">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="form-actions">
          <button class="btn btn-primary" id="addCardBtn">追加</button>
          <button class="btn btn-secondary" id="clearFormBtn">クリア</button>
        </div>
      </div>
    </section>

    <!-- ===== Today's Review ===== -->
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" />
        </svg>
        今日の復習
      </h2>
      <div id="reviewSection">
        <div class="no-review">
          <div class="no-review-icon">🎉</div>
          <div class="no-review-text">今日復習するカードはありません！</div>
        </div>
      </div>
    </section>

    <!-- ===== Category Cards ===== -->
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path
            d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
        分野別問題
      </h2>
      <div class="category-tabs" id="categoryTabs"></div>
      <div class="search-bar">
        <svg viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2" />
          <path d="M21 21l-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        </svg>
        <input type="text" id="searchInput" placeholder="キーワードで検索...">
      </div>
      <div class="card-list" id="cardList">
        <div class="empty-state">カードがありません</div>
      </div>
    </section>

  </div>

  <!-- ===== Study Modal ===== -->
  <div class="modal-overlay study-modal" id="studyModal">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title" id="studyModalTitle">学習中</span>
        <button class="modal-close" id="studyModalClose">
          <svg viewBox="0 0 24 24">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="progress-container">
          <div class="progress-text">
            <span id="progressLabel">1 / 1</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="progressBar" style="width:0%"></div>
          </div>
        </div>
        <div class="flashcard-container">
          <div class="flashcard" id="flashcard">
            <div class="flashcard-face flashcard-front">
              <div class="flashcard-label">問題</div>
              <div class="flashcard-content" id="flashcardFront"></div>
              <div class="flashcard-hint">クリックで解答を表示</div>
            </div>
            <div class="flashcard-face flashcard-back">
              <div class="flashcard-label">解答</div>
              <div class="flashcard-content" id="flashcardBack"></div>
            </div>
          </div>
        </div>
        <div class="answer-buttons hidden" id="answerButtons">
          <button class="btn btn-again" id="btnAgain">
            <span class="btn-interval" id="intervalAgain"></span>
            やり直し
          </button>
          <button class="btn btn-hard" id="btnHard">
            <span class="btn-interval" id="intervalHard"></span>
            難しい
          </button>
          <button class="btn btn-good" id="btnGood">
            <span class="btn-interval" id="intervalGood"></span>
            普通
          </button>
          <button class="btn btn-easy" id="btnEasy">
            <span class="btn-interval" id="intervalEasy"></span>
            簡単
          </button>
        </div>
        <div class="answer-buttons hidden" id="practiceButtons">
          <button class="btn btn-primary" id="btnRetry">もう一度</button>
          <button class="btn btn-secondary" id="btnFinish">終了</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Edit Modal ===== -->
  <div class="modal-overlay edit-modal" id="editModal">
    <div class="modal">
      <div class="modal-header">
        <span class="modal-title">カードを編集</span>
        <button class="modal-close" id="editModalClose">
          <svg viewBox="0 0 24 24">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="edit-form">
          <input type="hidden" id="editCardId">
          <div class="form-group">
            <label class="form-label">問題</label>
            <textarea class="form-input" id="editQuestion" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">解答</label>
            <textarea class="form-input" id="editAnswer" rows="3"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">分野</label>
            <select class="form-select" id="editCategory">
              <option value="">分野を選択してください</option>
              <optgroup label="テクノロジ系">
                <option value="基礎理論">基礎理論</option>
                <option value="コンピュータシステム">コンピュータシステム</option>
                <option value="データベース">データベース</option>
                <option value="ネットワーク">ネットワーク</option>
                <option value="セキュリティ">セキュリティ</option>
                <option value="システム開発">システム開発</option>
              </optgroup>
              <optgroup label="マネジメント系">
                <option value="プロジェクトマネジメント">プロジェクトマネジメント</option>
                <option value="サービスマネジメント">サービスマネジメント</option>
              </optgroup>
              <optgroup label="ストラテジ系">
                <option value="システム戦略">システム戦略</option>
                <option value="経営戦略">経営戦略</option>
                <option value="企業と法務">企業と法務</option>
              </optgroup>
            </select>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" id="saveEditBtn">保存</button>
            <button class="btn btn-secondary" id="cancelEditBtn">キャンセル</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Complete Modal ===== -->
  <div class="modal-overlay complete-modal" id="completeModal">
    <div class="modal">
      <div class="modal-body" style="padding:32px 24px;">
        <div class="complete-icon" id="completeIcon">🌟</div>
        <div class="complete-title" id="completeTitle">学習完了！</div>
        <div class="complete-stats" id="completeStats"></div>
        <div class="complete-message" id="completeMessage"></div>
        <button class="btn btn-primary btn-block" id="completeCloseBtn">閉じる</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- ===== Settings Modal ===== -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>設定</h2>
        <button class="modal-close" id="settingsCloseBtn">&times;</button>
      </div>
      <div class="modal-body">

        <!-- Sync / Auth Section -->
        <div class="setting-item" id="syncSection"
          style="margin-bottom: 2rem; background:var(--gray-50); padding:1rem; border-radius:var(--radius-md);">
          <h3 style="font-size:1rem;margin-bottom:0.5rem;">☁️ クラウド同期</h3>

          <!-- Not logged in -->
          <div id="authFormSection">
            <p style="margin-bottom:1rem;font-size:0.8rem;color:var(--gray-600);">
              アカウントでログインすると、PC・スマホ間でデータが自動同期されます。
            </p>
            <div style="display:flex;gap:0.5rem;margin-bottom:0.75rem;">
              <button class="btn btn-sm" id="authTabLogin" style="flex:1;"
                onclick="document.getElementById('authSignupFields').classList.add('hidden');document.getElementById('authTabLogin').classList.add('btn-primary');document.getElementById('authTabSignup').classList.remove('btn-primary');document.getElementById('authSubmitBtn').textContent='ログイン';document.getElementById('authSubmitBtn').dataset.mode='login';">ログイン</button>
              <button class="btn btn-sm" id="authTabSignup" style="flex:1;"
                onclick="document.getElementById('authSignupFields').classList.remove('hidden');document.getElementById('authTabSignup').classList.add('btn-primary');document.getElementById('authTabLogin').classList.remove('btn-primary');document.getElementById('authSubmitBtn').textContent='新規登録';document.getElementById('authSubmitBtn').dataset.mode='signup';">新規登録</button>
            </div>
            <input type="email" class="form-input" id="authEmail" placeholder="メールアドレス" style="margin-bottom:0.5rem;">
            <input type="password" class="form-input" id="authPassword" placeholder="パスワード"
              style="margin-bottom:0.5rem;">
            <div id="authSignupFields" class="hidden">
              <input type="password" class="form-input" id="authPasswordConfirm" placeholder="パスワード（確認）"
                style="margin-bottom:0.5rem;">
            </div>
            <p id="authError" style="color:#ef4444;font-size:0.8rem;margin-bottom:0.5rem;display:none;"></p>
            <button class="btn btn-primary btn-block" id="authSubmitBtn" data-mode="login">ログイン</button>
            <div style="display:flex;align-items:center;gap:0.5rem;margin:0.75rem 0;">
              <hr style="flex:1;border:none;border-top:1px solid var(--gray-200);">
              <span style="font-size:0.75rem;color:var(--gray-400);">または</span>
              <hr style="flex:1;border:none;border-top:1px solid var(--gray-200);">
            </div>
            <button class="btn btn-block" id="googleLoginBtn"
              style="background:var(--white);color:var(--gray-700);border:1px solid var(--gray-300);font-size:0.85rem;">
              <svg width="18" height="18" viewBox="0 0 48 48" style="margin-right:6px;">
                <path fill="#4285F4"
                  d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z" />
                <path fill="#34A853"
                  d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z" />
                <path fill="#FBBC05"
                  d="M10.53 28.59a14.5 14.5 0 0 1 0-9.18l-7.98-6.19a24.01 24.01 0 0 0 0 21.56l7.98-6.19z" />
                <path fill="#EA4335"
                  d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z" />
              </svg>
              Googleでログイン
            </button>
          </div>

          <!-- Logged in -->
          <div id="loggedInSection" class="hidden">
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.75rem;">
              <span style="font-size:1.2rem;">👤</span>
              <span id="loggedInEmail" style="font-size:0.85rem;color:var(--gray-700);"></span>
            </div>
            <div style="display:flex;gap:0.5rem;">
              <button class="btn btn-primary" id="syncNowBtn" style="flex:1;">🔄 今すぐ同期</button>
              <button class="btn btn-secondary" id="logoutBtn" style="flex:1;">ログアウト</button>
            </div>
            <p id="lastSyncTime" style="font-size:0.75rem;color:var(--gray-500);margin-top:0.5rem;"></p>
          </div>
        </div>

        <!-- Export / Import -->
        <div class="setting-item"
          style="margin-bottom: 2rem; background:var(--gray-50); padding:1rem; border-radius:var(--radius-md);">
          <h3 style="font-size:1rem;margin-bottom:0.5rem;">📁 データ管理</h3>
          <p style="margin-bottom:1rem;font-size:0.8rem;color:var(--gray-600);">
            JSON形式でデータの書き出し・読み込みができます。
          </p>
          <button class="btn btn-primary btn-block" id="exportDataBtn" style="margin-bottom:0.5rem;">データを書き出す</button>
          <input type="file" id="importFileInput" accept=".json,application/json,text/plain" style="display:none">
          <button class="btn btn-secondary btn-block" id="importDataBtn">ファイルを読み込む</button>
        </div>
      </div>
    </div>
  </div>



  <!-- Dexie.js for IndexedDB -->
  <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
  <!-- Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script src="db.js"></script>
  <script src="supabase-sync.js"></script>
  <script src="app.js"></script>
</body>

</html>